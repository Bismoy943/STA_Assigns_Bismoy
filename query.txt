---SQL Query---
select distinct SL.SUBL_ID as SUBL_ID, SL.SUBL_ID_TYPE as SUBL_ID_TYPE, Case when substring(ACCT.ACCT_ID,-2)='+C' and SL.GL_AMT_TYPE='BANL' then ACCT.ACCT_ID when substring(ACCT.ACCT_ID,-2)='+I' and SL.GL_AMT_TYPE='IPIA' then ACCT.ACCT_ID when substring(ACCT.ACCT_ID,-2)='+R' and SL.GL_AMT_TYPE='RPIP' then ACCT.ACCT_ID else ACCT.ACCT_ID end as TRAN_REF_NO, CASE WHEN ACCT.ACCT_ID IS NOT NULL THEN 'ACCT' ELSE 'NA' END as CAT_CD, SL.UNIQ_ID as UNIQ_ID, SL.SRC_SYS as SRC_SYS, SL.CTRY_CD as CTRY_CD, NULL as INSTR_ID, NULL as PTFOL_ID, PRTY_SP_TPCLIENT.PRTY_ID as PRTY_ID, PRTY_MP_TPCLIENT.PRTY_ID as PRTY_MAIN_ID, PRTY_SP_RISKPRTY.PRTY_ID as RISK_PRTY_ID, NULL as BKR_ID, NULL as CLRG_BKR_ID, ACCT.CP_ID as CP_ID, ACCT.RISK_PRTY_ID as SRC_RISK_PRTY_ID, NULL as SRC_BKR_ID, NULL as SRC_CLRG_BKR_ID, NULL as ACCT_STS_CD, ACCT.LIFCYCL_STS_CD as LIFCYCL_STS_CD, ACCT.LOCAL_PRD_CD as LOCAL_PRD_CD, ACCT.STD_PRD_CD as STD_PRD_CD, ACCT.BK_CD as BK_CD, ACCT.TP_ENT_NM as TP_ENT_NM, SL.LGL_ENT_CD as LGL_ENT_CD, SCBENTITYXLATE.SCI_ENTITY_CODE as BKG_LOC_CD, ACCT.LN_EFF_DT as ADJ_VAL_DT_1, ACCT.FST_LN_DRWDOWN_DT as TRD_DT, ACCT.MATURITY_DT as MATURITY_DT, ACCT.SETLM_DT as SETLM_DT, NULL as ALT_TRD_ID, NULL as ALT_TRD_SRC_SYS, NULL as EXTR_TRD_ID, ACCT.ACCT_REF_ID as CONTR_ID, NULL as ORIG_TRD_ID, NULL as NEAR_FAR_CD, NULL as BUY_SEL_FLG_1, NULL as BUY_SEL_FLG_2, NULL as PAY_RECV_FLG_1, NULL as PAY_RECV_FLG_2, NULL as TRD_LEND_BORROW_TYPE, NULL as PTFOL_NM, SL.GL_BIZ_UNIT_CD as GL_BIZ_UNIT_CD, SL.GL_ACCT_CD as GL_ACCT_CD, SL.GL_DEPT_CD as GL_DEPT_CD, SL.GL_AFFL_CD as GL_AFFL_CD, SL.GL_CUST_CLAS_CD as GL_CUST_CLAS_CD, COA.CHRT_FLD_LVL_0 as GL_CUST_CLAS_CD_DESC, SL.GL_OP_UNIT_CD as GL_OP_UNIT_CD, SL.GL_PRD_CD as GL_PRD_CD, SL.ACCT_CAT_NM as ACCT_CAT_NM, SL.COA_ACCT_CLAS as ACCT_CLAS, SL.ACCT_SUB_CAT_NM as ACCT_SUB_CAT_NM, SL.BASE_CCY as BASE_CCY, SL.CHRG_INT_CD as CHRG_INT_CD, SL.CTRY_LVL_ID as CTRY_LVL_ID, SL.IFRS_SCHED as IFRS_SCHED, SL.GL_AMT_TYPE as AMT_TYPE, SL.GL_CP_TYPE as GL_CP_TYPE, SL.IFRS_CP_TYPE_CD as IFRS_CP_TYPE_CD, SL.S4_OPR_LOC_CD as S4_OPR_LOC_CD, SL.S4_PRD_CD as S4_PRD_CD, SL.S4_PRFT_CTR as S4_PRFT_CTR, SL.S4_SGMT_CD as S4_SGMT_CD, SL.SUBL_ACCT as SUBL_ACCT, SL.SUBL_ACCT_DESC as SUBL_ACCT_DESC, SL.SUBL_ACCT_GRP as SUBL_ACCT_GRP, SL.SUBL_ACCT_GRP_DESC as SUBL_ACCT_GRP_DESC, SL.LOCAL_CCY as LOCAL_CCY, SL.GRP_CCY as GRP_CCY, SL.TRAN_CCY as TRAN_CCY, SL.BAL_AMT as BAL_AMT, SL.BAL_AMT_USD as BAL_AMT_USD, SL.GL_ITD_AMT as GL_ITD_AMT, SL.NOT_AMT_CCY_CD1 as NOT_AMT_CCY_1, SL.NOT_AMT_CCY_CD2 as NOT_AMT_CCY_2, SL.NOT_AMT1 as NOT_AMT_1, SL.NOT_AMT2 as NOT_AMT_2, SL.TRD_LEG_NUM as TRD_LEG_NUM, SL.INTCO_FLG as INTCO_FLG, SL.GL_EXCLN_FLG as GL_EXCLN_FLG, SL.ECL_EXPSR_FLG as ECL_EXPSR_FLG, SL.GL_ACCT_FLG as GL_ACCT_FLG, SL.LEAD_TRD_FLG as LEAD_TRD_FLG, SL.TRD_BK_CD as TRD_BK_CD, SL.SRC_TECH_ID as SEQ_ID, SL.SUBL_PRD_TYPE as SUBL_PRD_TYPE, 'FPSL' as DATA_SRC, SL.STRT_DT as STRT_DT, SL.END_DT as END_DT, SL.STRUC_FLG as STRUC_FLG, SL.STRUC_PRD_GRP as STRUC_PRD_GRP, SL.TP_SRC_SYS as TP_SRC_SYS, PRTY_MP_RISKPRTY.PRTY_ID as RISK_PRTY_MP_ID, NULL as SRC_CUST_ID, PGC.DESC as PGC_ACCT_DESC, PGC.CHRT_FLD_CAT_CD as PGC_BALANCE_TYPE, PGC.PGC_IFRSS_SCH as PGC_IFRSS_SCH, PGC.PGC_IFRSS_SCH_DESC as PGC_IFRSS_SCH_DESC, PGC.PGC_GRP_NONGRP as PGC_GRP_NONGRP, PGC.PGC_MR_SCH_REF as PGC_MR_SCH_REF, ACCTCLASS.ACCOUNTINGCLASSIFICATION as IFRS_ACCT_CLASS, JRNLSRC.DERIVED_ADM_JRNL_SRC as ADM_JRNL_SRC, PRTY_SP_TPCLIENT.PRTY_IFRS_CP_TYPE_CD as PRTY_IFRS_CP_TYPE_CD, SL.SRC_TECH_ID as TRAN_REF_ID, PER.EMP_CD as PRTY_ARM_CD, PRTYMST1.PRTY_LGL_NM as PRTY_NM, PRTYMST2.PRTY_LGL_NM as CP_NM, ACCT.LMT_PRD_CD as LMT_PRD_CD, ACCT.RECRSE_FLG as RECRSE_FLG, ACCT.DISCLR_IND as DISCLR_IND, ACCT.INT_RT_TYPE as INT_RT_TYPE, ACCT.INT_RT as INT_RT, ACCT.FUND_RT as FUND_RT, ACCT.CUST_MRGN_RT as CUST_MRGN_RT, ACCT.INT_RT_BSIS_CD as INT_ACR_BSIS_CD, ACCT.ACCT_CLSE_DT as ACCT_CLSE_DT, ACCT.ACCT_OPEN_DT as ACCT_OPEN_DT, ACCT.DAY_CNT_CONV_CD as DAY_CNT_CONV_CD, ACCT.LMT_CUST_ID as LMT_CUST_ID, ACCT.LMT_GRP_ID as LMT_GRP_ID, ACCT.LMT_ID as LMT_ID, ACCT.LMT_ID_2 as LMT_ID_2, ACCT.LMT_RESRV_ID as LMT_RESRV_ID, ACCT.LMT_RISK_PARTY_ID as LMT_RISK_PARTY_ID, ACCT.PRTNT_LMT_ID as PRTNT_LMT_ID, ACCT.PRTNT_LMT_ID_2 as PRTNT_LMT_ID_2, ACCT.SEL_DOWN_FLG as SEL_DOWN_FLG, ACCT_OPEN_BR_CD as ACCT_OPEN_BR_CD, ACCT.DISAPPROVED_PERIOD as DISAPPROVED_PERIOD, ACCT.FAC_ORIG_LOC as FAC_ORIG_LOC, ACCT.OBL_FLG as OBL_FLG, ACCT.BUYER_LE_ID as BUYER_LE_ID, ACCT.NONOBLIGOR_LE_ID as NONOBLIGOR_LE_ID, ACCT.OBLIGOR_LE_ID as OBLIGOR_LE_ID, ACCT.SUPPLIER_LE_ID as SUPPLIER_LE_ID, ACCT.SUSTAINABLE_FLAG as SUSTAINABLE_FLAG, ACCT.EXTR_PRTY_ID as EXTR_PRTY_ID, ACCT.EXTR_PRTY_NM as EXTR_PRTY_NM, NULL as FUNDED_FLG, SL.ODS_VAL as ODS from fdp_daas_uat.SUB_LDGR SL left outer join fdp_daas_uat.SUB_LDGR_ACCT_RLTD SLACCT_RL on SLACCT_RL.SUBL_ID=SL.SUBL_ID AND SLACCT_RL.TP_SYS_VAL='OTP' AND SLACCT_RL.SRC_SYS='OTP' AND SLACCT_RL.ODS_VAL=SL.ODS_VAL AND SLACCT_RL.country_val=SL.country_val AND SLACCT_RL.RL_TYPE_CD='SubLedgerToAccount' AND SLACCT_RL.PROCESS_ID_VAL='SUB_LDGR_ACCT_RLTD-OTP-FPSLBS' AND SLACCT_RL.ODS_VAL='2024-08-31' left outer join fdp_daas_uat.ACCT ACCT on ACCT.ACCT_ID=SLACCT_RL.ACCT_ID AND ACCT.country_val=SLACCT_RL.country_val AND ACCT.ODS_VAL=SLACCT_RL.ODS_VAL AND ACCT.TP_SYS_VAL=SLACCT_RL.TP_SYS_VAL AND ACCT.SRC_SYS='OTP' AND ACCT.PROCESS_ID_VAL='ACCT-OTP-TRDSTATIC' AND ACCT.ODS_VAL='2024-08-31' left outer join fdp_daas_uat.PRTY_ACCT_RLTD PARL_TPCLIENT on PARL_TPCLIENT.ACCT_ID=ACCT.ACCT_ID AND PARL_TPCLIENT.ODS_VAL=ACCT.ODS_VAL AND PARL_TPCLIENT.TP_SYS_VAL=ACCT.TP_SYS_VAL AND PARL_TPCLIENT.SRC_SYS=ACCT.SRC_SYS AND PARL_TPCLIENT.country_val=ACCT.country_val AND PARL_TPCLIENT.RL_TYPE_CD='TPCustomertoSubprofile' AND PARL_TPCLIENT.ODS_VAL='2024-08-31' AND PARL_TPCLIENT.PROCESS_ID_VAL = 'PRTY_ACCT_RLTD-OTP-TPCUST_FPSL' left outer join fdp_daas_uat.PRTY_ACCT_RLTD PARL_RISKPRTY on PARL_RISKPRTY.ACCT_ID=ACCT.ACCT_ID AND PARL_RISKPRTY.ODS_VAL=ACCT.ODS_VAL AND PARL_RISKPRTY.TP_SYS_VAL=ACCT.TP_SYS_VAL AND PARL_RISKPRTY.SRC_SYS=ACCT.SRC_SYS AND PARL_RISKPRTY.country_val=ACCT.country_val AND PARL_RISKPRTY.RL_TYPE_CD='RiskPartytoSubprofile' AND PARL_RISKPRTY.ODS_VAL='2024-08-31' AND PARL_RISKPRTY.PROCESS_ID_VAL = 'PRTY_ACCT_RLTD-OTP-RISKPRTY_FPSL' left outer join fdp_daas_uat.PRTY_RLTD PRL_TPCLIENT on PRL_TPCLIENT.PRTY_ID=PARL_TPCLIENT.PRTY_ID AND PRL_TPCLIENT.ODS_VAL=PARL_TPCLIENT.ODS_VAL AND PRL_TPCLIENT.SRC_SYS='SCI' AND PRL_TPCLIENT.RL_TYPE_CD='SubProfileToMainProfile' AND PRL_TPCLIENT.ODS_VAL='2024-08-31' AND PRL_TPCLIENT.PROCESS_ID_VAL = 'PRTY_RLTD-SCI-SUBPROF' left outer join fdp_daas_uat.PRTY_RLTD PRL_RISKPRTY on PRL_RISKPRTY.PRTY_ID=PARL_RISKPRTY.PRTY_ID AND PRL_RISKPRTY.ODS_VAL=PARL_RISKPRTY.ODS_VAL AND PRL_RISKPRTY.SRC_SYS='SCI' AND PRL_RISKPRTY.RL_TYPE_CD='SubProfileToMainProfile' AND PRL_RISKPRTY.ODS_VAL='2024-08-31' AND PRL_RISKPRTY.PROCESS_ID_VAL = 'PRTY_RLTD-SCI-SUBPROF' left outer join fdp_daas_uat.PRTY PRTY_MP_TPCLIENT on PRTY_MP_TPCLIENT.PRTY_ID=PRL_TPCLIENT.PRTY_RL_ID AND PRTY_MP_TPCLIENT.ODS_VAL=PRL_TPCLIENT.ODS_VAL AND PRTY_MP_TPCLIENT.SRC_SYS='SCI' AND PRTY_MP_TPCLIENT.PRTY_CAT_CD='MainProfile' AND PRTY_MP_TPCLIENT.ODS_VAL='2024-08-31' AND PRTY_MP_TPCLIENT.PROCESS_ID_VAL = 'PRTY-SCI-MAINPROF' left outer join fdp_daas_uat.PRTY PRTY_SP_TPCLIENT on PRTY_SP_TPCLIENT.PRTY_ID=PRL_TPCLIENT.PRTY_ID AND PRTY_SP_TPCLIENT.ODS_VAL=PRL_TPCLIENT.ODS_VAL AND PRTY_SP_TPCLIENT.SRC_SYS='SCI' AND PRTY_SP_TPCLIENT.PRTY_CAT_CD='SubProfile' AND PRTY_SP_TPCLIENT.ODS_VAL='2024-08-31' AND PRTY_SP_TPCLIENT.PROCESS_ID_VAL = 'PRTY-SCI-SUBPROF' left outer join fdp_daas_uat.PRTY PRTY_MP_RISKPRTY on PRTY_MP_RISKPRTY.PRTY_ID=PRL_RISKPRTY.PRTY_RL_ID AND PRTY_MP_RISKPRTY.ODS_VAL=PRL_RISKPRTY.ODS_VAL AND PRTY_MP_RISKPRTY.SRC_SYS='SCI' AND PRTY_MP_RISKPRTY.PRTY_CAT_CD='MainProfile' AND PRTY_MP_RISKPRTY.ODS_VAL='2024-08-31' AND PRTY_MP_RISKPRTY.PROCESS_ID_VAL = 'PRTY-SCI-MAINPROF' left outer join fdp_daas_uat.PRTY PRTY_SP_RISKPRTY on PRTY_SP_RISKPRTY.PRTY_ID=PRL_RISKPRTY.PRTY_ID AND PRTY_SP_RISKPRTY.ODS_VAL=PRL_RISKPRTY.ODS_VAL AND PRTY_SP_RISKPRTY.SRC_SYS='SCI' AND PRTY_SP_RISKPRTY.PRTY_CAT_CD='SubProfile' AND PRTY_SP_RISKPRTY.ODS_VAL='2024-08-31' AND PRTY_SP_RISKPRTY.PROCESS_ID_VAL = 'PRTY-SCI-SUBPROF' left outer join fdp_mfu_staging_dev.m_scb_entity_xlate scbentityxlate on (case when length(ACCT.ACCT_REF_ID)='12' then substring(ACCT.ACCT_REF_ID,1,3) else substring(ACCT.ACCT_REF_ID,3,3) end)=scbentityxlate.branch_code AND SL.CTRY_CD=scbentityxlate.country_code AND SL.ODS=scbentityxlate.ODS AND scbentityxlate.ODS='2024-08-31' AND tp_system = 'OTP' left outer join fdp_daas_uat.CHRT_OF_ACCT COA on SL.GL_CUST_CLAS_CD=COA.CHRT_FLD_ID AND COA.ODS_VAL=SL.ODS_VAL AND COA.SRC_SYS='RDM' AND COA.CHRT_FLD_TYPE_CD='CustomerClass' AND COA.ODS_VAL='2024-08-31' left outer join (Select distinct CHRT_FLD_ID,DESC, CHRT_FLD_CAT_CD, SRC_SYS, CHRT_FLD_TYPE_CD,PGC_IFRSS_SCH,PGC_IFRSS_SCH_DESC,PGC_GRP_NONGRP,PGC_MR_SCH_REF, ODS_VAL from fdp_daas_uat.CHRT_OF_ACCT PGC where PGC.ODS_VAL='2024-08-31' and CHRT_FLD_CAT_CD like '%P/L%' AND SRC_SYS='RDM' AND CHRT_FLD_TYPE_CD='Account') PGC on SL.GL_ACCT_CD=PGC.CHRT_FLD_ID AND PGC.ODS_VAL=SL.ODS_VAL left outer join FDP_MFU_STAGING_dev.M_IFRS9_ACCT_CLASS_XLATE ACCTCLASS on SL.GL_ACCT_CD=ACCTCLASS.PSGLACCOUNTFROM AND SL.GL_BIZ_UNIT_CD=ACCTCLASS.PSGLBU AND SL.GL_PRD_CD=ACCTCLASS.PSGLPRODUCTFROM AND SL.GL_DEPT_CD=ACCTCLASS.PSGLDEPTFROM AND ACCTCLASS.ODS=SL.ODS_VAL AND ACCTCLASS.ODS='2024-08-31' left outer join (select DISTINCT derived_adm_tp_source,derived_adm_jrnl_src,ods from FDP_MFU_STAGING_dev.M_PSGL_SRC_LSDR_SRC_SYS_XLATE where ODS='2024-08-31' ) JRNLSRC on SL.SRC_SYS=JRNLSRC.DERIVED_ADM_TP_SOURCE AND JRNLSRC.ODS=SL.ODS_VAL AND JRNLSRC.ODS='2024-08-31' left outer join fdp_mfu_staging_dev.m_gl_acct_amt_grp GL on SL.GL_ACCT_CD=GL.ACCT and GL.ODS='2024-08-31' left outer join fdp_daas_uat.PRTY_EMP_RLTD PER on PRTY_SP_TPCLIENT.PRTY_ID=PER.PRTY_ID AND SCBENTITYXLATE.SCI_ENTITY_CODE=PER.BKG_ORG_VAL AND PRTY_SP_TPCLIENT.ODS_VAL=PER.ODS_VAL AND PER.STAFF_BIZ_TYPE='FAM' AND PER.PRNC_FAM_FLG='Y' AND PER.EMP_CD is not null AND PER.PROCESS_ID_VAL='PRTY_EMP_RLTD-SCI-LSPEMPMAP' AND PER.ODS_VAL='2024-08-31' left outer join fdp_daas_uat.PRTY PRTYMST1 on PRTYMST1.PRTY_ID=ACCT.CP_ID AND PRTYMST1.ODS_VAL=SL.ODS_VAL AND PRTYMST1.CTRY_CD=SL.CTRY_CD AND PRTYMST1.PROCESS_ID_VAL='PRTY-OTP-CUST' AND PRTYMST1.ODS_VAL='2024-08-31' left outer join fdp_daas_uat.PRTY PRTYMST2 on PRTYMST2.PRTY_ID=ACCT.RISK_PRTY_ID AND PRTYMST2.ODS_VAL=SL.ODS_VAL AND PRTYMST2.CTRY_CD=SL.CTRY_CD AND PRTYMST2.PROCESS_ID_VAL='PRTY-OTP-CUST' AND PRTYMST2.ODS_VAL='2024-08-31' where SL.ODS_VAL='2024-08-31' AND SL.TP_SYS_VAL='OTP' AND SL.SRC_SYS='OTP' AND SL.GL_ACCT_CD not like '9%' AND PGC.CHRT_FLD_ID IS NULL and SL.PROCESS_ID_VAL='SUB_LDGR-OTP-FPSLBS'
